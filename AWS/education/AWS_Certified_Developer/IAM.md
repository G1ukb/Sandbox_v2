<h1> IAM </h1>

[//]:# (What is IAM?)

<details>
    <summary>
        <b><big><big>
            What is IAM?
        </big></big></b>
    </summary>

**AWS Identity and Access Management (IAM)** - сервис, который предоставляет 
возможности безопасного управления доступом к сервисам и ресурсам AWS.
Используя IAM, можно создавать пользователей AWS и группы, управлять ими,
а также использовать разрешения, чтобы предоставлять или запрещать доступ к ресурсам AWS.

**Компоненты IAM**:
- Пользователи (Users)              - Кто управляет системой
- Группы (Groups)                   - Объединения пользователей и выдача им правил работы
- Роли (Roles)                      - Правила доступа работы сервисов
- Полиси (Policies)                 - Правила доступа работы пользователей
- сервис токенов безопасности (STS) - предоставление временного доступа к записям 

**Главные функции IAM**:
- Вы можете предоставить другим людям разрешение на администрирование 
  и использование ресурсов в вашей учетной записи AWS, не сообщая свой пароль или ключ доступа.
- Вы можете предоставлять разные разрешения разным людям для разных ресурсов.
- Вы можете предоставляnm вашим приложениям разрешения на доступ к другим ресурсам AWS.
- Вы можете добавить двухфакторную аутентификацию для своей учетной записи 
  и для отдельных пользователей для дополнительной безопасности.
- Вы можете разрешить пользователям использовать (STS) для получения временного доступа
  к вашей учетной записи AWS.
- Мониторинг информации об удостоверениях IAM, которые запрашивали ресурсы в вашей учетной записи.
- IAM подтвержден на соответствие стандарту безопасности данных индустрии платежных карт (PCI) (DSS).
- IAM и AWS Security Token Service (STS) предлагаются без дополнительной оплаты.

</details>
<br>

[//]:# (What is the allow/deny priority order when policies are configured on
        different levels [group, user,  etc.]?)

<details>
    <summary>
        <b><big><big>
            What is the allow/deny priority order when 
            policies are configured on different levels (group, user,  etc.)?
        </big></big></b>
    </summary>

![Image alt](https://docs.aws.amazon.com/IAM/latest/UserGuide/images/PolicyEvaluationHorizontal.png)
Чтобы окончательно выставить приоритет проходятся следующие уровни проверок

1. **Неявное отрицание.**
   AWS оценивает все политики в аккаунте, применимые к запросу, 
   отклоняя запрос если находит Deny инструкцию
2. **Service control policies уровень.**
   AWS оценивает Service control policies применимые к организации.
   Если не находит никаких Allow в SCP, запрос неявно отклоняется.
3. **Политики на основе ресурсов.**
   Есть ли у запрошенного ресурса есть политика на основе ресурсов и эта политика 
   предоставляет Allow доступ. То запрос обрабатывается и это окончательное решение.
4. **IAM Граница разрешений (Permissions boundary)**
   Если политика, используемая для установки границы разрешений,
   не разрешает запрошенное действие, запрос отклоняется.
5. **Политика сессии**
   Если политика сеанса присутствует и не разрешает запрошенное действие, 
   запрос неявно отклоняется.
6. **Политики на основе идентификационных данных**
   Смотрятся политики пользователя и политики из групп, к которым принадлежит пользователь.
   Если какая-либо политика разрешает запрошенное действие, то решение окончательно «Разрешить».
   Если таких нет, то окончательно "Запретить"
7. **В любом месте проверки если находится ошибка** выбивается принудительное "Запретить"

Упрощенно:
- Проверка Аккаунта
- Проверка полиси организации
- Проверка полиси ресурсов (если allow на этом этапе то доспут дается, если нет идем дальше)
- Проверка IAM к пользователю
- Проверка сеанса сессии (если таковая имеется)
- Проверка групп в которых состоит пользователь

</details>
<br>

[//]:# (Programmatic access to AWS resources?)

<details>
    <summary>
        <b><big><big>
            Programmatic access to AWS resources?
        </big></big></b>
    </summary>

Доступ можно осуществить и через консоль. 
Все креды того или иного пользователя хранятся в папке ~/.aws/credentials

Консоль автоматически обращается за кредами в эту папку и пингует AWS сервисы для проверки
наличия полиси для указанного IAM профиля. 

</details>
<br>

[//]:# (Best IAM practices?)

<details>
    <summary>
        <b><big><big>
            Best IAM practices?
        </big></big></b>
    </summary>

- Заблокируйте ключи доступа корневого пользователя к своей учетной записи AWS
- Создание отдельных пользователей IAM
- Используйте группы для назначения разрешений пользователям IAM
- По возможности используйте политики, определенные AWS, для назначения разрешений
- Предоставить наименьшие привилегии
- Использование уровней доступа для просмотра разрешений IAM
- Настройте надежную политику паролей для ваших пользователей
- Включить MFA для привилегированных пользователей
- Используйте роли для приложений, работающих на инстансах Amazon EC2
- Используйте роли для делегирования разрешений
- Не сообщайте ключи доступа
- Регулярно меняйте учетные данные
- Удалить ненужные учетные данные
- Используйте условия политики для дополнительной безопасности
- Мониторинг активности в вашей учетной записи AWS

</details>
<br>