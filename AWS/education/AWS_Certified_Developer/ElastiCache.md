<h1>ElastiCache</h1>

[//]:# (What is ElastiCache?)

<details>
    <summary>
        <b><big><big>
            What is ElastiCache?
        </big></big></b>
    </summary>

ElastiCache Помогает снизить нагрузку на базы данных для рабочих нагрузок с интенсивным чтением.
**За счет кеширования запросов**

- ElastiCache управляется с помощью Redis или Memcached.
- Помогает сделать ваше приложение анонимным.
- AWS берет на себя обслуживание/установку исправлений ОС, оптимизацию, настройку,
  мониторинг, восстановление после сбоев и резервное копирование
- Использование ElastiCache **связано со значительными изменениями кода приложения**.

**Работает по следующему принципу**
- От клиента поступает запрос на получение данных.
- Этот запрос отправляется в ElastiCache
- Если запрос недоступен, запрос отправляется в RDS
- Ответ отправляется на сторону клиента и записывается в ElastiCache
- Таким образом следующий такой-же запрос вернется из кеша
- (Это помогает разгрузить RDS)
- (Кэш должен иметь стратегию аннулирования, чтобы убедиться, 
  что там используются только самые последние данные).

</details>
<br>

[//]:# (ElastiCache – Redis vs Memcached)

<details>
    <summary>
        <b><big><big>
            ElastiCache – Redis vs Memcached?
        </big></big></b>
    </summary>

Redis
- Несколько зон доступности с автоматическим аварийным переключением
- Реплики чтения для масштабирования операций чтения и обеспечения высокой доступности.
- Надежность данных благодаря сохранению AOF
- Функции резервного копирования и восстановления

Memcached
- Мультинод для разделения данных (шардинг)
- Нет высокой доступности (репликация)
- Не стойкий
- Нет резервного копирования и восстановления
- Многопоточная архитектура

</details>
<br>

[//]:# (ElastiCache – Cache Security)

<details>
    <summary>
        <b><big><big>
            ElastiCache – Cache Security
        </big></big></b>
    </summary>

Все кэши в ElastiCache:
- **Не поддерживать аутентификацию IAM.**

AUTH Redis
- Вы можете установить «пароль/токен» 
- Это дополнительный уровень безопасности для вашего кеша. (поверх групп безопасности)
- Поддержка SSL в шифровании полета

AUTH Memcached
- Поддерживает аутентификацию на основе SASL (расширенная)

</details>
<br>

[//]:# (ElastiCache Replication)

<details>
    <summary>
        <b><big><big>
            ElastiCache Replication
        </big></big></b>
    </summary>

Репликация для ElastiCache проходи в двух режимах. С включенным или выключенным кластер модом

**Cluster Mode выключен:**
- Один основной узел, до 5 реплик
- Асинхронная репликация
- Основной узел используется для чтения/записи.
- Остальные узлы доступны только для чтения
- Один осколок, все узлы имеют все данные
- Защита от потери данных в случае сбоя узла
- Несколько зон доступности включены по умолчанию для отработки отказа.
- Полезен для масштабирования производительности чтения

![](https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/images/ElastiCacheClusters-CSN-Redis-Replicas.png)

**Cluster Mode включен:**
- Данные разделены на сегменты (полезно в масштабе записи)
- Каждый осколок имеет основной и до 5 узлов-реплик (та же концепция, что и раньше)
- Возможность работы в нескольких зонах доступности
- До 500 узлов на кластер:
  - 500 осколков с одним мастером
  - 250 осколков с 1 мастером и 1 репликой
  - 83 осколка с одним мастером и 5 репликами

![](https://digitalcloud.training/wp-content/uploads/2022/01/elasticache-redis-cluster-mode-enabled.jpeg)

</details>
<br>

[//]:# (ElastiCache Caching strategies)

<details>
    <summary>
        <b><big><big>
            ElastiCache Caching strategies
        </big></big></b>
    </summary>

<h3>Lazy Loading / Cache-Aside / Lazy Population</h3>

![](https://miro.medium.com/max/1400/1*pP5PWsso59895EZ8BUYrFw.png)

**Плюсы:**
- Кешируются только запрошенные данные (кеш не заполняется неиспользуемыми данными)
- Отказы узлов не являются фатальными (просто увеличена задержка для прогрева кеша)

**Минусы**
- Штраф за промах кэша, который приводит к 3 обращениям туда и обратно, 
  заметной задержке для этого запроса.
- Устаревшие данные: данные могут быть обновлены в базе данных и устарели в кэше.

<h3>Write Through (сквозная запись) - добавление или обновление кеша при 
обновлении базы данных</h3>

![](https://miro.medium.com/max/686/1*4c2gEZR3yXkr48lhR5vO2w.png)

**Плюсы:**
- Данные в кеше никогда не устаревают, чтение выполняется быстро
- Штраф за запись против штрафа за чтение (каждая запись требует 2 вызовов)

**Минусы:**
- Отсутствующие данные, пока они не будут добавлены/обновлены в БД.
- Кэширование — большая часть данных никогда не будет прочитана.

<h3>Лучший метод</h3>
Лучший метод это сочетание сквозной записи и ленивой загрузки, потому что
разный тип данных должен записываться в кеш при разных обстоятельствах

</details>
<br>

[//]:# (ElastiCache сache Evictions and Time-to-live [TTL])

<details>
    <summary>
        <b><big><big>
            ElastiCache сache Evictions and Time-to-live (TTL)
        </big></big></b>
    </summary>

**Удаление кэша может происходить тремя способами:**
- Вы явно удаляете элемент из кеша
- Элемент удален, так как память заполнена и давно не использовалась (LRU).
- Вы устанавливаете срок жизни элемента (или TTL).

**TTL полезен для любого типа данных:**
- TTL может варьироваться от нескольких секунд до часов или дней.
- Если из-за памяти происходит слишком много выселений, следует увеличить или уменьшить масштаб.

</details>
<br>